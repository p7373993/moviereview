{% extends "base.html" %}

{% block content %}

<div class="container my-5">
  <div class="card shadow-sm rounded p-4" style="background-color: #2c2c2c; color: #e0e0e0; transition: box-shadow 0.3s;">
    <h3 class="mb-4 text-center" style="color: #f5f5f5;">ğŸ¬ ë¦¬ë·° ìˆ˜ì •</h3>
    <div class="row g-0">
      <div class="col-md-4">
        {% if movie.poster %}
        <img
          src="{{ movie.poster }}"
          alt="{{ movie.title }} í¬ìŠ¤í„°"
          class="img-fluid rounded-start"
          style="object-fit: cover; height: 100%"
        />
        {% else %}
        <div
          class="d-flex align-items-center justify-content-center h-100"
          style="background-color: #2c2c2c; color: #e0e0e0; font-size: 1.2rem;"
        >
          í¬ìŠ¤í„° ì—†ìŒ
        </div>
        {% endif %}
      </div>
      <div class="col-md-8 content-section">
        <div class="card-body">
          <h2 class="card-title mb-3" style="color: #f5f5f5;">{{ movie.title }}</h2>
          <p class="card-text"><strong>ê°ë…:</strong> {{ movie.director }}</p>
          <p class="card-text"><strong>ì¥ë¥´:</strong> {{ movie.genre }}</p>
          <p class="card-text">
            <strong>ê°œë´‰ì¼:</strong> {{ movie.release_date|date:"Yë…„ mì›” dì¼" }}
          </p>
          <p class="card-text">
            <strong>ë³„ì :</strong>
            <span class="badge bg-warning" style="color: #212121 !important;">{{ movie.rating }} / 5.0</span>
          </p>
          <p class="card-text">
            <strong>ë‚´ìš©:</strong> {{ movie.description }}
          </p>
        </div>
        <form
          method="post"
          action="{% url 'mypage:review_edit' user.username review_id %}"
        >
          {% csrf_token %}
          {% include "form_errors.html" %}

          <!-- ë¦¬ë·° ë‚´ìš© -->
          <div class="mb-4">
            <label for="content" class="form-label fw-bold" style="color: #f5f5f5;">ë¦¬ë·° ë‚´ìš©</label>
            <textarea
              name="content"
              id="content"
              class="form-control"
              rows="8"
              placeholder="ë¦¬ë·°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”."
              style="background-color: #444444; color: #e0e0e0; border-color: #555555; transition: border-color 0.3s;"
            >
{{ form.content.value|default_if_none:"" }}</textarea>
          </div>

          <!-- ë³„ì  UI -->
          <div class="mb-4">
            <label class="form-label fw-bold" style="color: #f5f5f5;">í‰ì </label>
            <div class="star-rating" style="display: flex; gap: 8px">
              {% for i in "12345" %}
              <label class="star" data-value="{{ i }}">â˜…</label>
              {% endfor %}
            </div>
            <input
              type="hidden"
              name="score"
              id="id_score"
              value="{{ form.score.value|default:'0' }}"
            />
          </div>

          <!-- ë²„íŠ¼ -->
          <div class="d-grid">
            <button
              type="submit"
              class="btn btn-lg"
              style="background-color: #1e88e5; color: #e0e0e0; border: none; transition: background-color 0.3s;"
              onmouseover="this.style.backgroundColor='#1565c0'"
              onmouseout="this.style.backgroundColor='#1e88e5'"
            >
              ğŸ’¾ ì €ì¥í•˜ê¸°
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ìŠ¤íƒ€ì¼ -->
<style>
  .star-rating {
    display: flex;
    gap: 8px;
  }

  .star {
    font-size: 2rem;
    cursor: pointer;
    color: #757575;
    transition: color 0.2s;
  }

  .star.selected,
  .star.hovered {
    color: #ffca28;
  }

  /* í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ íš¨ê³¼ */
  .form-control:focus {
    border-color: #1e88e5 !important;
    box-shadow: 0 0 5px rgba(30, 136, 229, 0.5) !important;
  }

  /* ì¹´ë“œ í˜¸ë²„ íš¨ê³¼ */
  .card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
  }

  /* ì˜¤ë¥¸ìª½ ì½˜í…ì¸  ì—¬ë°± */
  .content-section {
    padding-left: 10px;
  }
</style>

<!-- ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const stars = document.querySelectorAll(".star-rating .star");
    const hiddenInput = document.getElementById("id_score");

    // â­ï¸ í˜„ì¬ ì €ì¥ëœ ê°’ ê°€ì ¸ì˜¤ê¸°
    let currentValue = parseInt(hiddenInput.value);

    // ë³„ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateStars(value, className) {
      stars.forEach((s) => {
        s.classList.remove(className);
        if (parseInt(s.dataset.value) <= value) {
          s.classList.add(className);
        }
      });
    }

    // â­ï¸ ì´ˆê¸° ì ìˆ˜ ë°˜ì˜
    if (!isNaN(currentValue) && currentValue > 0) {
      updateStars(currentValue, "selected");
    }

    // â­ï¸ í´ë¦­ ì´ë²¤íŠ¸
    stars.forEach((star) => {
      star.addEventListener("click", () => {
        const value = parseInt(star.dataset.value);
        hiddenInput.value = value;
        currentValue = value;
        updateStars(value, "selected");
      });

      // ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ hover í‘œì‹œ
      star.addEventListener("mouseenter", () => {
        const value = parseInt(star.dataset.value);
        updateStars(value, "hovered");
      });

      // ë§ˆìš°ìŠ¤ ë‚˜ê°€ë©´ hover ì œê±°
      star.addEventListener("mouseleave", () => {
        updateStars(currentValue, "selected"); // hover ì§€ìš°ê³  ê¸°ì¡´ ê°’ ìœ ì§€
        stars.forEach((s) => s.classList.remove("hovered"));
      });
    });
  });
</script>

{% endblock %}