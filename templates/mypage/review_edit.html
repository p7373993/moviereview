{% extends "base.html" %} {% block content %} {% comment %}
<div class="container my-5">
  <div class="card shadow-sm rounded p-4">
    <h3 class="mb-4 text-center">ğŸ¬ ë¦¬ë·° ìˆ˜ì •</h3>
    <form
      method="post"
      action="{% url 'mypage:review_edit' user.username review_id %}"
    >
      {% csrf_token %} {% include "form_errors.html" %}

      <!-- ì˜í™” ì œëª© -->
      <div class="mb-4">
        <label for="subject" class="form-label fw-bold">ì˜í™” ì œëª©</label>
        <div id="subject" class="form-control bg-light">{{ subject }}</div>
      </div>

      <!-- ë¦¬ë·° ë‚´ìš© -->
      <div class="mb-4">
        <label for="content" class="form-label fw-bold">ë¦¬ë·° ë‚´ìš©</label>
        <textarea
          name="content"
          id="content"
          class="form-control"
          rows="8"
          placeholder="ë¦¬ë·°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”."
        >
{{ form.content.value|default_if_none:"" }}</textarea
        >
      </div>

      <!-- í‰ì  -->
      <div class="mb-4">
        <label for="score" class="form-label fw-bold">í‰ì  (0 ~ 5)</label>
        <input
          type="number"
          name="score"
          id="score"
          class="form-control"
          min="0"
          max="5"
          value="{{ form.score.value|default_if_none:'0' }}"
        />
      </div>

      <!-- ë²„íŠ¼ -->
      <div class="d-grid">
        <button type="submit" class="btn btn-primary btn-lg">
          ğŸ’¾ ì €ì¥í•˜ê¸°
        </button>
      </div>
    </form>
  </div>
</div>
{% endcomment %}
<div class="container my-5">
  <div class="card shadow-sm rounded p-4">
    <h3 class="mb-4 text-center">ğŸ¬ ë¦¬ë·° ìˆ˜ì •</h3>
    <div class="row g-0">
      <div class="col-md-4">
        {% if movie.poster %}
        <img
          src="{{ movie.poster }}"
          alt="{{ movie.title }} í¬ìŠ¤í„°"
          class="img-fluid rounded-start"
          style="object-fit: cover; height: 100%"
        />
        {% else %}
        <div
          class="d-flex align-items-center justify-content-center h-100 bg-light text-muted"
        >
          í¬ìŠ¤í„° ì—†ìŒ
        </div>
        {% endif %}
      </div>
      <div class="col-md-8">
        <div class="card-body">
          <h2 class="card-title mb-3">{{ movie.title }}</h2>
          <p class="card-text"><strong>ê°ë…:</strong> {{ movie.director }}</p>
          <p class="card-text"><strong>ì¥ë¥´:</strong> {{ movie.genre }}</p>
          <p class="card-text">
            <strong>ê°œë´‰ì¼:</strong> {{ movie.release_date|date:"Yë…„ mì›” dì¼" }}
          </p>
          <p class="card-text">
            <strong>ë³„ì :</strong>
            <span class="badge bg-warning text-dark"
              >{{ movie.rating }} / 5.0</span
            >
          </p>
          <p class="card-text">
            <strong>ë‚´ìš©:</strong> {{ movie.description }}
          </p>
        </div>
      </div>
      <form
        method="post"
        action="{% url 'mypage:review_edit' user.username review_id %}"
      >
        {% csrf_token %} {% include "form_errors.html" %}

        <!-- ë¦¬ë·° ë‚´ìš© -->
        <div class="mb-4">
          <label for="content" class="form-label fw-bold">ë¦¬ë·° ë‚´ìš©</label>
          <textarea
            name="content"
            id="content"
            class="form-control"
            rows="8"
            placeholder="ë¦¬ë·°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”."
          >
{{ form.content.value|default_if_none:"" }}</textarea
          >
        </div>

        <!-- ë³„ì  UI -->
        <div class="mb-4">
          <label class="form-label fw-bold">í‰ì </label>
          <div class="star-rating" style="display: flex; gap: 8px">
            {% for i in "12345" %}
            <label class="star" data-value="{{ i }}">&#9733;</label>
            {% endfor %}
          </div>
          <input
            type="hidden"
            name="score"
            id="id_score"
            value="{{ form.score.value|default:'0' }}"
          />
        </div>

        <!-- ë²„íŠ¼ -->
        <div class="d-grid">
          <button type="submit" class="btn btn-primary btn-lg">
            ğŸ’¾ ì €ì¥í•˜ê¸°
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ìŠ¤íƒ€ì¼ -->
  <style>
    .star-rating {
      display: flex;
      gap: 8px;
    }

    .star {
      font-size: 2rem;
      cursor: pointer;
      color: lightgray;
      transition: color 0.2s;
    }

    .star.selected,
    .star.hovered {
      color: gold;
    }
  </style>

  <!-- ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const stars = document.querySelectorAll(".star-rating .star");
      const hiddenInput = document.getElementById("id_score");

      // â­ï¸ í˜„ì¬ ì €ì¥ëœ ê°’ ê°€ì ¸ì˜¤ê¸°
      let currentValue = parseInt(hiddenInput.value);

      // ë³„ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      function updateStars(value, className) {
        stars.forEach((s) => {
          s.classList.remove(className);
          if (parseInt(s.dataset.value) <= value) {
            s.classList.add(className);
          }
        });
      }

      // â­ï¸ ì´ˆê¸° ì ìˆ˜ ë°˜ì˜
      if (!isNaN(currentValue) && currentValue > 0) {
        updateStars(currentValue, "selected");
      }

      // â­ï¸ í´ë¦­ ì´ë²¤íŠ¸
      stars.forEach((star) => {
        star.addEventListener("click", () => {
          const value = parseInt(star.dataset.value);
          hiddenInput.value = value;
          currentValue = value;
          updateStars(value, "selected");
        });

        // ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ hover í‘œì‹œ
        star.addEventListener("mouseenter", () => {
          const value = parseInt(star.dataset.value);
          updateStars(value, "hovered");
        });

        // ë§ˆìš°ìŠ¤ ë‚˜ê°€ë©´ hover ì œê±°
        star.addEventListener("mouseleave", () => {
          updateStars(currentValue, "selected"); // hover ì§€ìš°ê³  ê¸°ì¡´ ê°’ ìœ ì§€
          stars.forEach((s) => s.classList.remove("hovered"));
        });
      });
    });
  </script>

  {% endblock %}
</div>
